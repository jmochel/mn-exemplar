---
alwaysApply: false
globs: pom.xml
title: Maven Java Best Practices
description: Maven Java best practices for this project
scope: project
tags: [maven, java, best-practices]
---

# Java + Maven Best Practices (.mdc)

**Scope:** Java applications and libraries built with Maven (multi-module or single-module).  
**Normative language:** MUST / SHOULD / MAY.

---

## 1) JDK & Build Reproducibility
- Projects **MUST** target an LTS JDK (17 or 21). Pin toolchains with `maven-toolchains-plugin`.
- `maven-compiler-plugin` **MUST** set `<release>` (not `source`/`target`).
- Reproducible builds **MUST** be enabled via `project.build.outputTimestamp` and deterministic jar options.
- Lock plugin versions in the parent POM’s `<pluginManagement>`.

## 2) Dependency Management
- Use a **single parent POM** with `<dependencyManagement>`; child modules **MUST NOT** pin versions for managed deps.
- Prefer vendor BOMs via `<type>pom</type><scope>import</scope>` (e.g., Spring, Jackson, Micrometer).
- Enable `maven-enforcer-plugin` to ban duplicate/conflicting deps, disallow snapshots in main, and require JDK/Maven ranges.
- Shade **only** for CLI fat-jars. Libraries **MUST NOT** shade runtime deps.

## 3) Testing & Coverage
- **MUST** separate unit vs integration tests: `surefire` (unit) and `failsafe` (IT, `*IT.java`) 
- Run ITs on CI; local opt-out via a profile flag.
- `jacoco` **SHOULD** enforce a project-wide minimum (e.g., INSTRUCTION ≥ 75%), with package-specific overrides when justified.

## 4) Source Quality
- Enforce formatting with Spotless/Formatter (**SHOULD**). Style file lives in repo.
- Run `checkstyle`/`pmd`/`spotbugs` in `verify`; fail build on high severity only; warnings allowed but visible.
- No build-time logging; keep POM noise low.

## 5) Packaging & Modules
- Multi-module layout with a pure parent (`packaging` = `pom`); leaf modules are `jar`/`war` only.
- Avoid cyclic dependencies; enforce via Enforcer and/or ArchUnit.
- CLI apps: build one runnable JAR (assembly or shade). Libraries: plain JAR, no shaded transitive APIs.

## 6) Security & Supply Chain
- Use Enforcer banned-dependencies rules and/or OSS Index. Emit SBOM with `cyclonedx-maven-plugin` (**SHOULD**).
- Pin parent and plugin versions; no floating parents. No `systemPath` dependencies.

## 7) Versioning, Release, CI/CD
- Semantic versioning **SHOULD**. Releases via CI tags.
- `flatten-maven-plugin` for published POMs.
- CI caches `~/.m2` with checksums; use `--batch-mode` and a clean agent. Standard stage order: `validate → test → integration-test → verify → package → deploy`.

---

## Example: Parent `pom.xml` (drop-in)

> Place this at repo root as the aggregator/parent. Child modules inherit dependency versions and plugin locks.
> Adjust groupId/artifactId/version to your org.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>example-parent</artifactId>
  <version>1.0.0</version>
  <packaging>pom</packaging>
  <name>Example :: Parent</name>
  <description>Parent POM with BOMs, pluginManagement, enforcer, and reproducible build settings.</description>

  <!-- Reproducible builds -->
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.release>21</maven.compiler.release>
    <maven.compiler.parameters>true</maven.compiler.parameters>

    <!-- Reproducible jar timestamps -->
    <project.build.outputTimestamp>${maven.build.timestamp}</project.build.outputTimestamp>
    <maven.build.timestamp.format>yyyy-MM-dd'T'HH:mm:ss'Z'</maven.build.timestamp.format>

    <!-- Centralize plugin versions -->
    <plugin.compiler.version>3.13.0</plugin.compiler.version>
    <plugin.surefire.version>3.2.5</plugin.surefire.version>
    <plugin.failsafe.version>3.2.5</plugin.failsafe.version>
    <plugin.jacoco.version>0.8.12</plugin.jacoco.version>
    <plugin.enforcer.version>3.5.0</plugin.enforcer.version>
    <plugin.versions.version>2.17.1</plugin.versions.version>
    <plugin.flatten.version>1.5.0</plugin.flatten.version>
    <plugin.spotless.version>2.43.0</plugin.spotless.version>
    <plugin.checkstyle.version>3.5.0</plugin.checkstyle.version>
    <plugin.spotbugs.version>4.8.6.5</plugin.spotbugs.version>
    <plugin.javadoc.version>3.7.0</plugin.javadoc.version>
    <plugin.deploy.version>3.1.2</plugin.deploy.version>
    <plugin.jar.version>3.4.2</plugin.jar.version>

    <!-- Dependency versions (examples; prefer BOM imports below) -->
    <jackson.version>2.17.2</jackson.version>
    <junit.version>5.10.2</junit.version>
  </properties>

  <!-- Toolchains (pin JDK) -->
  <build>
    <pluginManagement>
      <plugins>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>${plugin.compiler.version}</version>
          <configuration>
            <release>${maven.compiler.release}</release>
            <parameters>${maven.compiler.parameters}</parameters>
          </configuration>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>${plugin.surefire.version}</version>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-failsafe-plugin</artifactId>
          <version>${plugin.failsafe.version}</version>
          <executions>
            <execution>
              <goals>
                <goal>integration-test</goal>
                <goal>verify</goal>
              </goals>
            </execution>
          </executions>
        </plugin>

        <plugin>
          <groupId>org.jacoco</groupId>
          <artifactId>jacoco-maven-plugin</artifactId>
          <version>${plugin.jacoco.version}</version>
          <executions>
            <execution>
              <goals>
                <goal>prepare-agent</goal>
              </goals>
            </execution>
            <execution>
              <id>report</id>
              <phase>verify</phase>
              <goals>
                <goal>report</goal>
              </goals>
            </execution>
            <execution>
              <id>check</id>
              <phase>verify</phase>
              <goals>
                <goal>check</goal>
              </goals>
              <configuration>
                <rules>
                  <rule>
                    <element>BUNDLE</element>
                    <limits>
                      <limit>
                        <counter>INSTRUCTION</counter>
                        <value>COVEREDRATIO</value>
                        <minimum>0.75</minimum>
                      </limit>
                    </limits>
                  </rule>
                </rules>
              </configuration>
            </execution>
          </executions>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-enforcer-plugin</artifactId>
          <version>${plugin.enforcer.version}</version>
          <executions>
            <execution>
              <id>enforce-rules</id>
              <goals>
                <goal>enforce</goal>
              </goals>
              <configuration>
                <rules>
                  <requireMavenVersion>
                    <version>[3.9.0,)</version>
                  </requireMavenVersion>
                  <requireJavaVersion>
                    <version>[17,)</version>
                  </requireJavaVersion>
                  <banDuplicatePomDependencyVersions/>
                  <banDuplicateClasses/>
                  <requireUpperBoundDeps/>
                  <bannedDependencies>
                    <excludes>
                      <exclude>*.**:*:*:jar:sources</exclude>
                      <exclude>*.**:*:*:jar:javadoc</exclude>
                    </excludes>
                  </bannedDependencies>
                  <requireReleaseDeps>
                    <onlyWhenRelease>true</onlyWhenRelease>
                  </requireReleaseDeps>
                </rules>
                <fail>true</fail>
              </configuration>
            </execution>
          </executions>
        </plugin>

        <plugin>
          <groupId>org.codehaus.mojo</groupId>
          <artifactId>flatten-maven-plugin</artifactId>
          <version>${plugin.flatten.version}</version>
          <configuration>
            <updatePomFile>true</updatePomFile>
            <flattenMode>oss</flattenMode>
          </configuration>
          <executions>
            <execution>
              <id>flatten</id>
              <phase>process-resources</phase>
              <goals><goal>flatten</goal></goals>
            </execution>
            <execution>
              <id>flatten-clean</id>
              <phase>clean</phase>
              <goals><goal>clean</goal></goals>
            </execution>
          </executions>
        </plugin>

        <!-- Formatting (Spotless) -->
        <plugin>
          <groupId>com.diffplug.spotless</groupId>
          <artifactId>spotless-maven-plugin</artifactId>
          <version>${plugin.spotless.version}</version>
          <configuration>
            <java>
              <googleJavaFormat/>
            </java>
          </configuration>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-checkstyle-plugin</artifactId>
          <version>${plugin.checkstyle.version}</version>
          <configuration>
            <failsOnError>true</failsOnError>
            <violationSeverity>error</violationSeverity>
          </configuration>
        </plugin>

        <plugin>
          <groupId>com.github.spotbugs</groupId>
          <artifactId>spotbugs-maven-plugin</artifactId>
          <version>${plugin.spotbugs.version}</version>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-javadoc-plugin</artifactId>
          <version>${plugin.javadoc.version}</version>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-deploy-plugin</artifactId>
          <version>${plugin.deploy.version}</version>
        </plugin>

        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-jar-plugin</artifactId>
          <version>${plugin.jar.version}</version>
          <configuration>
            <archive>
              <manifestEntries>
                <Build-Time>${maven.build.timestamp}</Build-Time>
              </manifestEntries>
              <manifest>
                <addDefaultImplementationEntries>true</addDefaultImplementationEntries>
                <addDefaultSpecificationEntries>true</addDefaultSpecificationEntries>
              </manifest>
            </archive>
          </configuration>
        </plugin>

      </plugins>
    </pluginManagement>
  </build>

  <!-- Centralized dependency versions -->
  <dependencyManagement>
    <dependencies>
      <!-- Example vendor BOMs -->
      <dependency>
        <groupId>com.fasterxml.jackson</groupId>
        <artifactId>jackson-bom</artifactId>
        <version>${jackson.version}</version>
        <type>pom</type>
        <scope>import</scope>
      </dependency>
      <dependency>
        <groupId>org.junit</groupId>
        <artifactId>junit-bom</artifactId>
        <version>${junit.version}</version>
        <type>pom</type>
        <scope>import</scope>
      </dependency>
    </dependencies>
  </dependencyManagement>

  <modules>
    <!-- Add your modules here -->
    <!-- <module>app</module> -->
    <!-- <module>lib</module> -->
  </modules>

  <profiles>
    <!-- Example: enable integration tests explicitly -->
    <profile>
      <id>it</id>
      <activation>
        <property>
          <name>it</name>
        </property>
      </activation>
      <build>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <version>${plugin.failsafe.version}</version>
            <executions>
              <execution>
                <goals>
                  <goal>integration-test</goal>
                  <goal>verify</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>

</project>
```

---

## Child Module (`pom.xml`) sketch

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>com.example</groupId>
    <artifactId>example-parent</artifactId>
    <version>1.0.0</version>
    <relativePath>..</relativePath>
  </parent>

  <artifactId>example-lib</artifactId>
  <packaging>jar</packaging>
  <name>Example :: Lib</name>

  <dependencies>
    <!-- Versions managed by parent BOMs -->
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-databind</artifactId>
    </dependency>

    <dependency>
      <groupId>org.junit.jupiter</groupId>
      <artifactId>junit-jupiter</artifactId>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-jar-plugin</artifactId>
      </plugin>
    </plugins>
  </build>
</project>
```

---

## Conventions Quick Reference
- **No SNAPSHOTs on main**; release via tags.
- **Unit vs IT** strictly separated; ITs run with `-Pit`.
- **Formatting enforced**; style config checked in.
- **No shaded libs**; only apps may produce fat-jars.
- **Dependency versions** live in parent BOMs, not children.
- **CI**: `mvn -B -ntp verify` on clean agents; cache `~/.m2` with checksum/MD5/SHA enabled.
